# Story 6.1: Fix Installation Issues (Dependencies + Documentation)

## Status

Ready for Review

## Story

**As a** user installing WriteScore via the Quick Start instructions,
**I want** complete dependency declarations and accurate documentation,
**so that** the package installs and runs correctly on first try.

## Acceptance Criteria

### Missing Dependency Fix

1. `scikit-learn>=1.3.0` is added to the `dependencies` list in `pyproject.toml`
2. Fresh install via `pip install -e .` (without requirements.txt) succeeds
3. `writescore analyze` command works with figurative language dimension enabled
4. No `ModuleNotFoundError: No module named 'sklearn'` errors occur
5. `requirements.txt` remains in sync (already has scikit-learn, no change needed)

### Quick Start Documentation Fix

6. README Quick Start section includes spaCy model download step
7. Users following Quick Start instructions can run `writescore analyze` without errors

## Tasks / Subtasks

- [x] **Task 1: Update pyproject.toml** (AC: 1)
  - [x] Add `"scikit-learn>=1.3.0",` to the `dependencies` list after existing ML dependencies (torch, transformers)

- [x] **Task 2: Update README Quick Start** (AC: 6, 7)
  - [x] Add spaCy model download to Quick Start section
  - [x] Update from 2 lines to 3 lines

- [x] **Task 3: Verify installation** (AC: 2, 3, 4, 7)
  - [x] Create fresh virtual environment
  - [x] Follow README Quick Start instructions exactly
  - [x] Run `python -c "from sklearn.metrics.pairwise import cosine_similarity; print('OK')"`
  - [x] Run `writescore analyze README.md --mode full` (full mode includes figurative_language dimension)
  - [x] Verify no import errors

- [x] **Task 4: Verify requirements.txt consistency** (AC: 5)
  - [x] Confirm requirements.txt already has `scikit-learn>=1.3.0` (it does)
  - [x] No changes needed to requirements.txt

## Dependencies

**Depends On:** None (first story in epic)

**Blocks:** All other Epic 6 stories (foundational fix)

---

## Dev Notes

### Issue 1: Missing scikit-learn Dependency

The `figurative_language.py` dimension was added in Story 2.1 with this import:

```python
# src/writescore/dimensions/figurative_language.py:46
from sklearn.metrics.pairwise import cosine_similarity
```

However, `scikit-learn` was only added to `requirements.txt` (used for dev setup) but not to `pyproject.toml` (used for package installation).

### Issue 2: Quick Start Missing spaCy Download

Current Quick Start (README lines 15-18):
```bash
pip install -e .
writescore analyze README.md
```

This fails because spaCy model isn't downloaded. Should be:
```bash
pip install -e .
python -m spacy download en_core_web_sm
writescore analyze README.md
```

### Affected Files

| File | Issue | Change |
|------|-------|--------|
| `pyproject.toml` | Missing scikit-learn | Add `"scikit-learn>=1.3.0"` to dependencies |
| `README.md` | Quick Start incomplete | Add spaCy download step |

### pyproject.toml Location

Add after line 30 (after torch):

```toml
dependencies = [
    "marko>=2.0.0",
    "nltk>=3.8",
    "spacy>=3.7.0",
    "textstat>=0.7.3",
    "transformers>=4.35.0",
    "torch>=2.0.0",
    "scikit-learn>=1.3.0",  # <-- ADD HERE
    "scipy>=1.11.0",
    ...
]
```

### README Quick Start Update

Change from:
```markdown
## Quick Start

```bash
pip install -e .
writescore analyze README.md
```
```

To:
```markdown
## Quick Start

```bash
pip install -e .
python -m spacy download en_core_web_sm
writescore analyze README.md
```
```

### Testing

**Testing Standards:**
- No unit tests needed (dependency declaration, not code logic)
- Manual verification via fresh venv install

**Verification Commands:**
```bash
# Create fresh environment
python -m venv /tmp/test-writescore
source /tmp/test-writescore/bin/activate

# Install without requirements.txt
pip install -e .

# Verify sklearn import
python -c "from sklearn.metrics.pairwise import cosine_similarity; print('sklearn OK')"

# Verify full analysis works (includes figurative_language)
python -m spacy download en_core_web_sm
writescore analyze README.md --mode full

# Cleanup
deactivate
rm -rf /tmp/test-writescore
```

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-12-06 | 1.0 | Initial story creation for dependency bug fix | PM Agent (John) |

## Dev Agent Record

### Agent Model Used

Claude Opus 4.5 (claude-opus-4-5-20250929)

### Debug Log References

None - implementation was straightforward

### Completion Notes List

- Added `scikit-learn>=1.3.0` to pyproject.toml dependencies (line 31)
- Added spaCy model download step to README Quick Start section
- Verified fresh venv installation succeeds
- Verified sklearn import works: `from sklearn.metrics.pairwise import cosine_similarity`
- Verified `writescore analyze README.md --mode full` runs without import errors
- Confirmed requirements.txt already has scikit-learn (line 20)
- Ruff linting passes
- Core unit tests pass (437 tests)

### File List

| File | Action |
|------|--------|
| `pyproject.toml` | Modified - added scikit-learn to dependencies |
| `README.md` | Modified - added spaCy download to Quick Start |

## QA Results

### Review Date: 2025-12-06

### Reviewed By: Quinn (Test Architect)

### Code Quality Assessment

Implementation is clean and focused. The scikit-learn dependency was correctly added to `pyproject.toml` line 31, and the README Quick Start now includes the spaCy model download step. This is a low-risk documentation/configuration change with no code logic changes.

### Refactoring Performed

None required - changes are configuration-only.

### Compliance Check

- Coding Standards: ✓ N/A (no code changes)
- Project Structure: ✓ Follows standard pyproject.toml and README conventions
- Testing Strategy: ✓ Manual verification appropriate for dependency/docs changes
- All ACs Met: ✓ All 7 acceptance criteria verified

### Improvements Checklist

- [x] scikit-learn>=1.3.0 added to pyproject.toml dependencies
- [x] spaCy download step added to README Quick Start
- [x] requirements.txt consistency verified (already had scikit-learn)
- [x] Fresh venv installation tested by dev agent

### Security Review

No security concerns - dependency version pinning follows existing patterns with minimum version constraints.

### Performance Considerations

No performance impact - dependency declaration only.

### Files Modified During Review

None - no modifications needed.

### Gate Status

Gate: PASS → docs/qa/gates/6.1-fix-installation-issues.yml

### Recommended Status

✓ Ready for Done
