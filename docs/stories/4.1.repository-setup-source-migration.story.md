# Story 4.1: Repository Setup & Source Migration

## Status

Done

## Story

**As a** writescore maintainer,
**I want** the writescore package extracted to a standalone repository with proper src-layout,
**so that** it can be developed, versioned, and distributed independently.

## Acceptance Criteria

1. New git repository initialized at `/Users/jmagady/Dev/writescore`
2. Repository has proper Python .gitignore
3. Source code located at `src/writescore/` following PEP 517/518 src-layout
4. All subpackages migrated: core, cli, dimensions, scoring, utils, history, evidence, data
5. All internal imports updated to work with src-layout (`from writescore.x import y`)
6. pyproject.toml configured for src-layout with unified version (6.1.0)
7. setup.py removed (pyproject.toml only)
8. Package installs successfully via `pip install -e .`
9. `writescore --help` executes without error
10. `writescore analyze --help` shows available commands

## Tasks / Subtasks

- [x] **Task 1: Initialize Repository** (AC: 1, 2)
  - [x] Create directory `/Users/jmagady/Dev/writescore`
  - [x] Run `git init`
  - [x] Create comprehensive Python .gitignore (include .coverage, htmlcov/, *.egg-info/, dist/, build/, __pycache__/, .pytest_cache/, *.pyc, .env, .venv/)
  - [x] Create initial commit

- [x] **Task 2: Create src-layout Structure** (AC: 3, 4)
  - [x] Create `src/writescore/` directory
  - [x] Copy `__init__.py` to `src/writescore/`
  - [x] Copy `core/` to `src/writescore/core/`
  - [x] Copy `cli/` to `src/writescore/cli/`
  - [x] Copy `dimensions/` to `src/writescore/dimensions/`
  - [x] Copy `scoring/` to `src/writescore/scoring/`
  - [x] Copy `utils/` to `src/writescore/utils/`
  - [x] Copy `history/` to `src/writescore/history/`
  - [x] Copy `evidence/` to `src/writescore/evidence/`
  - [x] Copy `data/` to `src/writescore/data/` (lexicons, fixtures)
  - **EXCLUSIONS**: Do NOT copy `tests/`, `docs/`, `scripts/`, `config/`, `htmlcov/`, `*.egg-info/`, `__pycache__/` - tests/docs/scripts migrate in Story 4.2; others are build artifacts or empty

- [x] **Task 3: Update Import Paths** (AC: 5)
  - [x] Audit all Python files for relative imports using: `grep -rn "^from \." src/writescore/`
  - [x] Also check for: `grep -rn "^from \.\." src/writescore/`
  - [x] Convert relative imports to absolute (`from writescore.core import x`)
  - [x] Verify no circular import issues
  - [x] Test imports work in isolation: `python -c "from writescore.core.analyzer import AIPatternAnalyzer"`

- [x] **Task 4: Configure pyproject.toml** (AC: 6, 7)
  - [x] Create new pyproject.toml with src-layout configuration:
    ```toml
    [build-system]
    requires = ["setuptools>=61.0", "wheel"]
    build-backend = "setuptools.build_meta"

    [project]
    name = "writescore"
    version = "6.1.0"
    # ... rest of config

    [tool.setuptools.packages.find]
    where = ["src"]
    ```
  - [x] Consolidate dependencies from both pyproject.toml and setup.py
  - [x] Remove setup.py (not needed with modern pyproject.toml)
  - [x] Configure entry point: `writescore = "writescore.cli.main:cli"`

- [x] **Task 5: Copy Supporting Files** (AC: 8)
  - [x] Copy README.md to repo root
  - [x] Copy CHANGELOG.md to repo root
  - [x] Copy requirements.txt to repo root (for reference/legacy)
  - [x] Create LICENSE file with MIT license (file does not exist in source - use standard MIT template with "BOHICA Labs" as copyright holder and current year)

- [x] **Task 6: Verify Installation** (AC: 8, 9, 10)
  - [x] Create fresh virtual environment
  - [x] Run `pip install -e .`
  - [x] Verify no installation errors
  - [x] Run `writescore --help`
  - [x] Run `writescore analyze --help`
  - [x] Run `python -c "from writescore.core.analyzer import Analyzer; print('OK')"`

## Dev Notes

### Source Directory Structure (Current → Target)

```
CURRENT:                              TARGET:
writescore/                           writescore/           (repo root)
├── __init__.py                       ├── src/
├── core/                             │   └── writescore/
├── cli/                              │       ├── __init__.py
├── dimensions/                       │       ├── core/
├── scoring/                          │       ├── cli/
├── utils/                            │       ├── dimensions/
├── history/                          │       ├── scoring/
├── evidence/                         │       ├── utils/
├── data/                             │       ├── history/
├── tests/          ──(Story 4.2)──►  │       ├── evidence/
├── docs/           ──(Story 4.2)──►  │       └── data/
├── scripts/        ──(Story 4.2)──►  ├── tests/
├── pyproject.toml                    ├── docs/
├── setup.py        ──(remove)──►     ├── scripts/
├── README.md                         ├── pyproject.toml
└── CHANGELOG.md                      ├── README.md
                                      └── CHANGELOG.md
```

### Key pyproject.toml Configuration

```toml
[build-system]
requires = ["setuptools>=61.0", "wheel"]
build-backend = "setuptools.build_meta"

[project]
name = "writescore"
version = "6.1.0"
description = "AI writing pattern analysis and scoring tool"
readme = "README.md"
license = {text = "MIT"}
requires-python = ">=3.8"
authors = [{name = "BOHICA Labs"}]
classifiers = [
    "Development Status :: 4 - Beta",
    "Intended Audience :: Developers",
    "Topic :: Text Processing :: Linguistic",
    "License :: OSI Approved :: MIT License",
    "Programming Language :: Python :: 3",
    "Programming Language :: Python :: 3.8",
    "Programming Language :: Python :: 3.9",
    "Programming Language :: Python :: 3.10",
    "Programming Language :: Python :: 3.11",
    "Programming Language :: Python :: 3.12",
]
dependencies = [
    "marko>=2.0.0",
    "nltk>=3.8",
    "spacy>=3.7.0",
    "textstat>=0.7.3",
    "transformers>=4.35.0",
    "torch>=2.0.0",
    "scipy>=1.11.0",
    "textacy>=0.13.0",
    "numpy>=1.24.0",
    "click>=8.0.0",
]

[project.optional-dependencies]
dev = [
    "pytest>=7.4.0",
    "pytest-cov>=4.1.0",
    "pytest-timeout>=2.2.0",
    "psutil>=5.9.0",
    "ruff>=0.1.0",
]
semantic = [
    "sentence-transformers>=2.0.0",
]
ml = [
    "accelerate>=0.20.0",
    "datasets>=2.14.0",
]

[project.scripts]
writescore = "writescore.cli.main:cli"

[project.urls]
Homepage = "https://github.com/jmagady/writescore"
Repository = "https://github.com/jmagady/writescore"
Documentation = "https://github.com/jmagady/writescore#readme"

[tool.setuptools.packages.find]
where = ["src"]

[tool.setuptools.package-data]
writescore = ["data/*.json", "data/*.txt"]
```

### Import Update Pattern

```python
# BEFORE (may have relative imports)
from .core.analyzer import Analyzer
from ..utils.text_processing import tokenize

# AFTER (absolute imports)
from writescore.core.analyzer import Analyzer
from writescore.utils.text_processing import tokenize
```

### Testing

- Test file location: `tests/` at repo root (Story 4.2)
- For this story: manual verification only
- Full test suite verification in Story 4.2

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-11-25 | 1.0 | Initial story creation | Sarah (PO Agent) |
| 2025-11-25 | 1.1 | Validation remediation: Fixed entry point (cli not main), added data to AC 4, added exclusions note, added import audit patterns, clarified LICENSE creation, updated author to BOHICA Labs | Sarah (PO Agent) |

## Dev Agent Record

### Agent Model Used

Claude Opus 4.5 (claude-opus-4-5-20251101)

### Debug Log References

None - no blockers encountered

### Completion Notes List

- Repository already existed at /Users/jmagady/Dev/writescore with git init and initial commit
- Added comprehensive .gitignore (81 lines covering Python, IDE, coverage, cache artifacts)
- Migrated 8 subpackages: core, cli, dimensions, scoring, utils, history, evidence, data
- Found only 2 relative imports in dimensions/__init__.py - converted to absolute imports
- No double-dot relative imports or old package name references found
- pyproject.toml configured with version 6.1.0, MIT license, BOHICA Labs author
- Entry point verified: writescore.cli.main:cli
- All AC verified: pip install, writescore --help, writescore analyze --help, import test

### File List

**Created in /Users/jmagady/Dev/writescore:**
- .gitignore (new)
- LICENSE (new)
- pyproject.toml (new)
- README.md (copied from source)
- CHANGELOG.md (copied from source)
- requirements.txt (copied from source)
- src/writescore/__init__.py
- src/writescore/cli/__init__.py, args.py, formatters.py, main.py
- src/writescore/core/__init__.py, analysis_config.py, analyzer.py, dataset.py, deployment.py, dimension_loader.py, dimension_registry.py, distribution_analyzer.py, dynamic_reporter.py, exceptions.py, interpretability.py, normality.py, parameter_derivation.py, parameter_loader.py, parameters.py, recalibration.py, results.py, validation.py, weight_mediator.py
- src/writescore/dimensions/__init__.py (modified), advanced_lexical.py, ai_vocabulary.py, base.py, base_strategy.py, burstiness.py, figurative_language.py, formatting.py, lexical.py, perplexity.py, pragmatic_markers.py, predictability.py, readability.py, semantic_coherence.py, sentiment.py, structure.py, syntactic.py, transition_marker.py, voice.py
- src/writescore/scoring/__init__.py, dimension_stats.json, domain_thresholds.py, dual_score.py, dual_score_calculator.py, score_normalization.py
- src/writescore/utils/__init__.py, pattern_matching.py, text_processing.py, visualization.py
- src/writescore/history/__init__.py, export.py, tracker.py, trends.py
- src/writescore/evidence/__init__.py
- src/writescore/data/idiom_lexicon.json, idiom_lexicon.txt

## QA Results

### Review Date: 2025-11-25

### Reviewed By: Quinn (Test Architect)

### Code Quality Assessment

Excellent implementation. The repository migration follows Python packaging best practices with proper src-layout (PEP 517/518). pyproject.toml is correctly configured with all dependencies, entry points, and package discovery. The .gitignore is comprehensive (82 lines) covering all common Python artifacts. All 8 subpackages successfully migrated with absolute imports.

### Refactoring Performed

None required - implementation is clean and follows best practices.

### Compliance Check

- Coding Standards: N/A (infrastructure/migration story)
- Project Structure: [x] Proper src-layout following PEP 517/518
- Testing Strategy: [x] Tests deferred to Story 4.2 as planned
- All ACs Met: [x] All 10 acceptance criteria verified

### Acceptance Criteria Verification

| AC | Description | Status | Evidence |
|----|-------------|--------|----------|
| 1 | Git repository initialized | PASS | `/Users/jmagady/Dev/writescore/.git/` exists, 3 commits |
| 2 | Proper Python .gitignore | PASS | 82-line comprehensive .gitignore |
| 3 | src-layout at `src/writescore/` | PASS | Directory structure verified |
| 4 | All subpackages migrated | PASS | core, cli, dimensions, scoring, utils, history, evidence, data |
| 5 | Absolute imports | PASS | `grep -rn "^from \."` returns no results |
| 6 | pyproject.toml with version 6.1.0 | PASS | Verified in file |
| 7 | setup.py removed | PASS | File does not exist |
| 8 | Editable install works | PASS | `pip show writescore` confirms editable install |
| 9 | `writescore --help` works | PASS | CLI executes, shows 6 commands |
| 10 | `writescore analyze --help` works | PASS | Shows all analysis options |

### Improvements Checklist

All items handled by developer - no outstanding work.

### Security Review

No security concerns - this is a repository/infrastructure setup story with no security-sensitive code.

### Performance Considerations

N/A for infrastructure story.

### Files Modified During Review

None - no refactoring required.

### Gate Status

Gate: **PASS** -> docs/qa/gates/4.1-repository-setup-source-migration.yml

### Recommended Status

[x] Ready for Done

Story owner may proceed to mark as Done. Test migration continues in Story 4.2.
